$(document).ready(function(){$(document).on("resizestop",".grid-stack",function(b,c){setWidgetHeight(b.target)});$(window).on("resize",function(){setAllWidgetsHeight()});$(document).on("resizestop dragstop",".grid-stack",function(b,c){let data=a();dashboardWidgetCache(data)});$("#lnkSidebarCollapse").on("click",function(){if($("body").hasClass("aside-collapsed")){closeDashboardRepository()}});function a(){let serializedData=_.map($(".grid-stack > .grid-stack-item:visible:not(.grid-stack-placeholder)"),function(b){b=$(b);let node=b.data("_gridstack_node");return{x:node.x,y:node.y,width:node.width,height:node.height,id:node.id}});return JSON.stringify(serializedData,null,"    ")}});function initWidgetGrid(a){$(".grid-stack").gridstack({width:6,cellHeight:5,minHeight:100,handle:".panel-heading",alwaysShowResizeHandle:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),resizable:{handles:"w, e"}});if(a){GridStackUI.Utils.sort(a)}}function setAllWidgetsHeight(){let gridStack=$(".grid-stack");gridStack.find(".grid-stack-item").each(function(){setWidgetHeight(this)})}function setWidgetHeight(d){let gridStack=$(".grid-stack");var b=5;var h=20;var c=gridStack.data("gridstack");var e=$(d).attr("data-gs-width");if($(d).find(".inner-content").length){var f=$(d).find(".inner-content").outerHeight();var g=Math.floor(f/(b+h)-1);var a=g+3;c.resize(d,e,a)}}function setWidgetHeightWithDelay(a){setTimeout(function(){setWidgetHeight(a)},800)}function dashboardWidgetCache(a){$.ajax({url:url("manage/account/save/widgets/"+a),cache:false}).done(function(b){if(b=="1"){$("#btnWidgetsSaved").click()}else{$("#btnWidgetsNotSaved").click()}})}function openDashboardRepository(){let id="column-repository";let $div=$("#column-repository");let $parent=$div.parent();if($("body").hasClass("aside-collapsed")){$("body").removeClass("aside-collapsed")}if($(window).outerWidth()<768&&!$("body").hasClass("aside-toggled")){$("body").addClass("aside-toggled")}$parent.slideDown("fast");if($parent.attr("data-content")=="no"){divReload(id);$parent.attr("data-content","")}}function closeDashboardRepository(){let id="column-repository";let $div=$("#column-repository");let $parent=$div.parent();$parent.slideUp("fast")}function viewCombolist(a){let $this=$(a),comboContainer=$(".combo-container");$this.addClass("noDisplay");comboContainer.removeClass("noDisplay");$(".refresh-widget-button").addClass("noDisplay");$(".remove-widget-button").removeClass("noDisplay")}function endWidgetSetting(){$(".remove-widget-button").addClass("noDisplay");$(".refresh-widget-button").removeClass("noDisplay");$(".start-setting-btn").removeClass("noDisplay");$(".combo-container").addClass("noDisplay")}function RemoveDashboradWidget(a){var d=$(a),c=d.parents(".grid-stack-item"),b=c.attr("id");$.ajax({url:url("manage/account/save/widgets-remove/"+b),cache:false}).done(function(e){if(e){divReload("widgetSettingContainer");$("#btnWidgetsSaved").click();c.slideUp().remove()}})}function dashboardCollapse(a){let id=a.attr("id");let parent_id=a.parent().attr("id");let body_id=id+"-body";let $body=$("#"+body_id);let $panel=$("#"+id+"-panel");let $refresh_button=$("#"+id+"-refresh");let original_color=$panel.attr("data-color");if(parent_id=="column-repository"){$body.slideUp("fast");$panel.addClass("panel-default").removeClass("panel-"+original_color)}else{$body.slideDown();$panel.removeClass("panel-default").addClass("panel-"+original_color);if($body.attr("data-content")=="no"){divReload(body_id);$body.attr("data-content","")}}};